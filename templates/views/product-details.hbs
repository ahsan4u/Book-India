 <!DOCTYPE html>
<html lang="en">
<head>
    {{>head}}
    <script
      src="https://kit.fontawesome.com/64d58efce2.js"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="/stylesheets/other.css">
    <link rel="stylesheet" href="/stylesheets/book.css">

    <link rel="stylesheet" href="/stylesheets/product-details.css">
</head>
<body>
 {{>top}}

    <div class="items-container">
    <div class="first-row">
      <div class="product-img-container">
        <img class="product-img" src="/books/{{book.image}}" alt="">
      </div>
        
      <div class="product-details-container">
          <h1 class="name-heading">{{book.name}}</h1>
          
          <div class="product-details">
           {{#if book.auther}}<p class="by">By: {{book.auther}} <small> (Auther)</small></p>{{/if}}
          </div>

          <div class="price-qty">
            <p id="new-price">₹{{book.price}} <span class="off-msg">off 20%</span></p>
            <div class="qty-container">
              <span class ="minus" onclick="minus()">-</span>
              <input type="number" name="qty" value="1" class="qty" disabled>
              <span class="plus" onclick="plus()">+</span>
            </div>
          </div> <!-- price-qty -->
          
          <p class="price-before">M.R.P.: {{book.price}}</p> <!-- price-before -->

          <div class="quality">
            <div>
              <img src="/img-controller/icons/lock.png">
              <p>quality Checked</p>
            </div>

            <div>
              <img src="/img-controller/icons/delivery.png">
              <p>Easy Return</p>
            </div>

            <div>
              <img src="/img-controller/icons/cashondelivery.png">
              <p>COD Available</p>
            </div>
          </div> <!-- quality -->

          <div class="description-container">
            <h2 class="description-heading">Book Description:</h2>
            <div class="description">{{book.description}}</div>  
          </div> <!-- description-container -->

          <div class="cart-buy-container">  
            {{#if user}}
              <input id="cart" onclick="addToCart('{{book._id}}');" type="submit" value="add to cart">
              <input id="buy" onclick="buyPage('{{book._id}}');" type="button" value="Buy Now">
            {{else}}
              <input id="cart" onclick="loginRedirect()" type="button" value="Add To Cart">
              <input id="buy" onclick="loginRedirect()" type="button" value="Buy Now">
            {{/if}}
            {{#if user.admin}}
              <input id="delete" onclick="deleteBook('{{book._id}}');" type="button" value="Delete">
            {{/if}}
          </div> <!-- cart-buy-container -->
      </div> <!-- product-details-container -->
    </div> <!-- first row -->
   
    <div class= "second-row">
     <div class="middleware">
        {{!-- Books with the same Auther --}}
        <a class="see-more-btn" href="/books">See More...</a>   
        <h2 id="categorie-heading">Books With the same Auther</h2>
        <img src="/img-controller/icons/right-arrow.png" alt=">" class="right-arrow">
        <img src="/img-controller/icons/left-arrow.png" alt="<" class="left-arrow">
    
        <div class="scroll">
            {{#each sameAuther}}
                <div class="item">
                    <a id="bookLink" href="/books/{{_id}}">
                        <img id="book" src="/books/{{image}}" alt="{{image}}"><br>
                        {{!-- <div class="deal-msg"><small>Up to 59% off</small></div><br> --}}
                        <span id="auther">{{auther}} <span style="color:lightgray"> auther</span></span><br>
                        <span id="price">{{price}}₹</span>
                        <span id="book-name">{{name}}</span>
                    </a>
                </div> <!-- item -->
            {{/each}}
        </div> <!-- scroll -->
     </div> <!-- middleware -->
    </div> <!-- second row -->

    <table class="specification-table">
        <tr id="first-row">
            <td colspan="4"><h2 id="specification-heading">Book Specification</h2></td>
        </tr>

        <tr id="second-row">
            <td>
                <div class="specification-content">
                    <ul>
                        {{#if book.isbn}}<li><b>ISBN-13</b></li>{{/if}}
                        {{#if book.publisher}}<li><b>Publisher</b></li>{{/if}}
                        {{#if book.binding}}<li><b>Binding</b></li>{{/if}}
                        {{#if book.language}}<li><b>Language</b></li>{{/if}}
                    </ul>
                </div>

            <td>
                <div class="specification-result">
                    {{#if book.isbn}}<p>{{book.isbn}}</p>{{/if}}
                    {{#if book.publisher}}<p>{{book.publisher}}</p>{{/if}}
                    {{#if book.binding}}<p>{{book.binding}}</p>{{/if}}
                    {{#if book.language}}<p>{{book.language}}</p>{{/if}}
                </div>  
            </td>

            <td>
                <div class="specification-content">
                    <ul>
                        {{#if book.pages}} <li><b>No. of Pages</b></li>{{/if}}
                        {{#if book.publishedDate}} <li><b>Publisher Date</b></li>{{/if}}
                        {{#if book.width}} <li><b>Width</b></li>{{/if}}
                        {{#if book.height}} <li><b>Height</b></li>{{/if}}
                    </ul>
                </div>
            </td>

            <td>
                <div class="specification-result">
                    {{#if book.pages}} <p>{{book.pages}}</p> {{/if}}
                    {{#if book.publishedDate}} <p>{{book.publishedDate}}</p> {{/if}}
                    {{#if book.width}} <p>{{book.width}}mm</p> {{/if}}
                    {{#if book.height}} <p>{{book.height}}mm</p> {{/if}}
                </div>
            </td>
        </tr>
    </table>

    </div>
    {{>footer}}
    {{>navbarScrollEffect}}   
    <script src="/scripts/index.js"></script>
    <script>
     let qtyVal = document.querySelector('.qty');
     function plus() {
      if(Number(qtyVal.value) <= 5) {
        qtyVal.value = Number(qtyVal.value) + 1;
      }
     }
     function minus() {
      if(Number(qtyVal.value) >1) {
       qtyVal.value = Number(qtyVal.value) - 1;
      }
     }
        function addToCart(bookId) {
          fetch(`/add-to-cart/${bookId}/${qtyVal.value}`,
           {
               method: 'post',
               headers: { 'Content-Type': `application/json` }
           })
           .then((respone)=> {
            if(!respone.ok) { console.log('an error is occured'); }
            window.location.href=`/books/${bookId}`;
           })
           .catch((error)=> {
               alert('error to add item to the cart');
               console.log('script fetch ',error);
           });
        }

        function buyPage(bookId) {
          window.location.href=`/place-order/${bookId}/${qtyVal.value}`;
        }
        function loginRedirect() {
          window.location.href='/sign-in-up';
        }

        function deleteBook(bookId) {
          fetch(`/delete/${bookId}`,
            {
              method: 'post',
              headers: { 'Content-Type': `application/json` }
            })
            .then((respone)=> {
              if(!respone.ok) { console.log('an error is occured'); }
            }).then(()=> {
              window.location.href='/';
              alert('Successfully deleted');
            })
            .catch((error)=> {
              alert('error in deleting book');
              console.log('script fetch ',error);
            })
        }

        function addToLike(bookId) {
          fetch(`/add-to-likes/${bookId}`,
           {
               method: 'post',
               headers: { 'Content-Type': `application/json` }
           })
           .then((respone)=> {
           if(!respone.ok) {
               console.log('an error is occured');
           }})
           .catch((error)=> {
               alert('You are not logged in');
               console.log('script fetch ',error);
           });
        }
    </script>
</body>
